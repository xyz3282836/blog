import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,a as e}from"./app-DCNG99d6.js";const n={},t=e(`<h2 id="一次线上gdb分析" tabindex="-1"><a class="header-anchor" href="#一次线上gdb分析"><span>一次线上gdb分析</span></a></h2><p>debian 换源</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/deb.debian.org/mirrors.aliyun.com/g&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/apt/sources.list</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Ubuntu 22.04 换源，vim /etc/apt/sources.list</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>deb http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse</span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse</span></span>
<span class="line"><span>deb http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse</span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse</span></span>
<span class="line"><span>deb http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse</span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse</span></span>
<span class="line"><span>deb http://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse</span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse</span></span>
<span class="line"><span>deb http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse</span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>or 执行下面命令</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo bash -c &quot;cat &lt;&lt; EOF &gt; /etc/apt/sources.list</span></span>
<span class="line"><span>deb http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse</span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse</span></span>
<span class="line"><span>deb http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse</span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse</span></span>
<span class="line"><span>deb http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse</span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse</span></span>
<span class="line"><span>deb http://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse</span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse</span></span>
<span class="line"><span>deb http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse</span></span>
<span class="line"><span>deb-src http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse</span></span>
<span class="line"><span>EOF&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分析环境</p><p>M1 mackoopro 是 arm 平台（aarch 是 arm v8 的一种状态）</p><p>我们的服务环境是 debian，x86_64，所以分析的环境最好也是同样的环境</p><p>强制拉 amd64 的 image</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --platform=linux/amd64</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> debian:stable</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>运行，需要指定 amd64 平台</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> debians-dev</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /Users/zhou/dockersyncfile:/root/sync</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -itd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --platform</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> linux/amd64</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> debian:stable</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>安装 gdb</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gdb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>gdb 开始分析 core 文件</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> php</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>core-file</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">core-file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> coredumpfile</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">//</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> output</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">core-file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> core.998</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Core</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> was</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> generated</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> by</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/data/app/room-service/frontend/boot/index.php</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> [ServerProcess] [app:room][worke&#39;.</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Program terminated with signal SIGSEGV, Segmentation fault.</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">#0  swHashMap_find_int (hmap=0x0, key=1) at /root/repo/php-bin/php-7.0.33/ext/swoole/src/core/hashmap.c:237</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">237	/root/repo/php-bin/php-7.0.33/ext/swoole/src/core/hashmap.c: No such file or directory.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>bt</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bt</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#0  swHashMap_find_int (hmap=0x0, key=1) at /root/repo/php-bin/php-7.0.33/ext/swoole/src/core/hashmap.c:237</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#1  0x000000000086976e in swoole_http2_onFrame (client=0x2662f50, req=0x1, req@entry=0x7ffc9b75ee90) at /root/repo/php-bin/php-7.0.33/ext/swoole/swoole_http_v2_server.c:594</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#2  0x0000000000867fcf in http_onReceive (serv=0x25a75f0, req=0x7ffc9b75ee90) at /root/repo/php-bin/php-7.0.33/ext/swoole/swoole_http_server.c:1066</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#3  0x000000000089e941 in swWorker_onTask (factory=0xb0, task=0x7ffc9b75ee90) at /root/repo/php-bin/php-7.0.33/ext/swoole/src/network/Worker.c:307</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#4  0x000000000089ecd1 in swWorker_onPipeReceive (reactor=&lt;optimized out&gt;, event=0x7ffc9b760ef0) at /root/repo/php-bin/php-7.0.33/ext/swoole/src/network/Worker.c:814</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#5  0x000000000088ca60 in swReactorEpoll_wait (reactor=0x25aca70, timeo=0x1) at /root/repo/php-bin/php-7.0.33/ext/swoole/src/reactor/ReactorEpoll.c:255</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#6  0x000000000089f1b4 in swWorker_loop (factory=factory@entry=0x25a7a68, worker_id=worker_id@entry=1) at /root/repo/php-bin/php-7.0.33/ext/swoole/src/network/Worker.c:772</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#7  0x000000000089c14a in swManager_spawn_worker (factory=0x25a7a68, worker_id=1) at /root/repo/php-bin/php-7.0.33/ext/swoole/src/network/Manager.c:507</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#8  0x000000000089cc69 in swManager_loop (factory=&lt;optimized out&gt;) at /root/repo/php-bin/php-7.0.33/ext/swoole/src/network/Manager.c:386</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#9  swManager_start (factory=0x25a7a68) at /root/repo/php-bin/php-7.0.33/ext/swoole/src/network/Manager.c:178</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#10 0x0000000000888fba in swFactoryProcess_start (factory=0x25a7a68) at /root/repo/php-bin/php-7.0.33/ext/swoole/src/factory/FactoryProcess.c:86</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#11 0x000000000089138b in swServer_start (serv=0x25a75f0) at /root/repo/php-bin/php-7.0.33/ext/swoole/src/network/Server.c:747</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#12 0x00000000008637bc in zim_swoole_http_server_start (execute_data=0x7f4f1d014e60, return_value=0x7f4f1d014e50) at /root/repo/php-bin/php-7.0.33/ext/swoole/swoole_http_server.c:1633</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#13 0x00000000009ca692 in ZEND_DO_FCALL_SPEC_HANDLER () at /root/repo/php-bin/php-7.0.33/Zend/zend_vm_execute.h:842</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#14 0x0000000000985f5b in execute_ex (ex=&lt;optimized out&gt;) at /root/repo/php-bin/php-7.0.33/Zend/zend_vm_execute.h:414</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#15 0x00000000009d9d47 in zend_execute (op_array=0x7f4f1d08a000, op_array@entry=0x7f4f1d1b8e40, return_value=return_value@entry=0x7f4f1d014af0)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    at</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/repo/php-bin/php-7.0.33/Zend/zend_vm_execute.h:458</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#16 0x00000000009482f4 in zend_execute_scripts (type=type@entry=8, retval=0x7f4f1d014af0, retval@entry=0x0, file_count=file_count@entry=3) at /root/repo/php-bin/php-7.0.33/Zend/zend.c:1445</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#17 0x00000000008eaa30 in php_execute_script (primary_file=0x7ffc9b7636f0) at /root/repo/php-bin/php-7.0.33/main/main.c:2516</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#18 0x00000000009db95a in do_cli (argc=0, argv=0x1) at /root/repo/php-bin/php-7.0.33/sapi/cli/php_cli.c:977</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#19 0x0000000000499cb7 in main (argc=0, argv=0x1) at /root/repo/php-bin/php-7.0.33/sapi/cli/php_cli.c:1347</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>frame 1</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">//</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> output</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">frame</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#1  0x000000000086976e in swoole_http2_onFrame (client=0x2662f50, req=0x1, req@entry=0x7ffc9b75ee90) at /root/repo/php-bin/php-7.0.33/ext/swoole/swoole_http_v2_server.c:594</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">594</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	/root/repo/php-bin/php-7.0.33/ext/swoole/swoole_http_v2_server.c:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> No</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> such</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> or</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> directory.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>没有源代码，需要 set substitute-path</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> substitute-path</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/repo/php-bin/php-7.0.33/ext/swoole</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/sync/swoole-bili-1.10.5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>重新查看</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">frame</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#1  0x000000000086976e in swoole_http2_onFrame (client=0x2662f50, req=0x1, req@entry=0x7ffc9b75ee90) at /root/repo/php-bin/php-7.0.33/ext/swoole/swoole_http_v2_server.c:594</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">594</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	    {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> client</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">http2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">$1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>http2 为 1，不符合预期</p><p>查看 req 的实际信息</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">frame</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#2  0x0000000000867fcf in http_onReceive (serv=0x25a75f0, req=0x7ffc9b75ee90) at /root/repo/php-bin/php-7.0.33/ext/swoole/swoole_http_server.c:1066</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1066</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	        return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> swoole_http2_onFrame</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">client,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> req</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">req</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">$2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = {</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {fd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2068,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 88,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from_id</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;\\n&#39;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flags</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;\\000&#39;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from_fd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">},</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  data</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;\\000\\000O\\000\\000\\000\\000\\000\\001\\000\\000\\000\\000J\\n\\026live.live.room-service\\022\\005sh001\\032\\023\\067\\066\\064\\067\\070\\062\\064\\064\\060\\065\\060\\064\\066\\064\\067\\061\\071\\062\\071</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\\005\\062.3.0*\\r10.150.113.62cd61cd1ed475571ba5d3f94cf49cf4 HTTP/1.1\\r\\nhost: api.live.bilibili.co\\r\\nx-forwarded-for: 10.230.17.157,172.22.33.26&quot;...}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>把变量输出的 size 调大</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> print</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> elements</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4096</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">req</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">$3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = {</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {fd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2068,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 88,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from_id</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;\\n&#39;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flags</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;\\000&#39;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from_fd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">},</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  data</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;\\000\\000O\\000\\000\\000\\000\\000\\001\\000\\000\\000\\000J\\n\\026live.live.room-service\\022\\005sh001\\032\\023\\067\\066\\064\\067\\070\\062\\064\\064\\060\\065\\060\\064\\066\\064\\067\\061\\071\\062\\071</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\\005\\062.3.0*\\r10.150.113.62cd61cd1ed475571ba5d3f94cf49cf4 HTTP/1.1\\r\\nhost: api.live.bilibili.co\\r\\nx-forwarded-for: 10.230.17.157,172.22.33.26\\r\\nuser-agent: haoguanwei@bilibili.com go1.17.2 app-feed-list-api-test-77645bb6cd-lcz7d main.app-svr.app-feed\\r\\nx-backend-bili-criticality: \\r\\nx1-bilispy-color: \\r\\nx1-bilispy-id: 238066525567990090\\r\\nx1-bilispy-mirror: \\r\\nx1-bilispy-parentid: 0\\r\\nx1-bilispy-sampled: true\\r\\nx1-bilispy-spanid: 238066525567990090\\r\\naccept-encoding: gzip\\r\\nx-forwarded-proto: http\\r\\nx-envoy-external-address: 172.22.33.26\\r\\nx-request-id: ab160a44-cca8-9e55-abf7-3cc0d7dd15df\\r\\nx-b3-traceid: 2f094b2c5ca7a552034dc83e6164394a\\r\\nx-b3-spanid: 0152b03b1fdfb655\\r\\nx-b3-parentspanid: 034dc83e6164394a\\r\\nx-b3-sampled: 1\\r\\nbili-trace-id: 034dc83e6164394a:0152b03b1fdfb655:034dc83e6164394a:1\\r\\nx-bili-trace-id: 2f094b2c5ca7a552034dc83e6164394a:0152b03b1fdfb655:034dc83e6164394a:1\\r\\nx1-bilispy-timeout: 10000\\r\\nx1-bilispy-user: ekango\\r\\ncontent-length: 0\\r\\nx-envoy-expected-rq-timeout-ms: 15000\\r\\n\\r\\n\\r\\n\\374\\177\\000\\000\\060\\000\\000\\000\\060\\000\\000\\000&gt;\\363u\\233\\374\\177\\000\\000\\320\\362u\\233\\374\\177\\000\\000@\\000\\000\\000\\000\\000\\000\\000\\020\\000\\000\\000\\377\\377\\377\\377\\000\\000\\000\\000\\000\\000\\000\\000\\377\\377\\377\\377&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;\\000&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">repeats</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">s&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;\\220\\363u\\233\\374\\177\\000\\000\\340\\060\\v\\035O\\177\\000\\000\\220\\344\\244\\016O\\177\\000\\000\\300G\\212\\001\\000\\000\\000\\000\\330\\344\\244\\016O\\177\\000\\000\\020\\364u\\233\\374\\177\\000\\000\\000\\340\\b\\035O\\177\\000\\000\\300G\\212\\001\\000\\000\\000\\000\\372\\070\\223\\000\\000\\000\\000\\000\\370&amp;\\273\\017O\\177\\000\\000\\337&lt;O&lt;\\000\\340\\377\\377\\240\\370u\\233\\374\\177\\000\\000k\\000\\000\\000\\000\\000\\000\\000\\003\\000\\000\\000\\000\\000\\000\\000\\250\\340\\244\\016O\\177\\000\\000\\330\\344\\244\\016O\\177\\000\\000\\313A\\223\\000\\000\\000\\000\\000\\300G\\212\\001&quot;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;\\000&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">repeats</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 12</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">s&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="reference" tabindex="-1"><a class="header-anchor" href="#reference"><span>Reference</span></a></h2><p>https://sourceware.org/gdb/onlinedocs/gdb/Source-Path.html#set-substitute_002dpath</p><p>https://sourceware.org/gdb/onlinedocs/gdb/Command-Settings.html#Command-Settings</p>`,36),l=[t];function h(r,p){return s(),a("div",null,l)}const c=i(n,[["render",h],["__file","gdb.html.vue"]]),o=JSON.parse('{"path":"/tech/linux/gdb.html","title":"gdb","lang":"zh-CN","frontmatter":{"title":"gdb","date":"2023-04-25T07:27:00.000Z","category":"linux","tag":["linux","shell"],"description":"一次线上gdb分析 debian 换源 Ubuntu 22.04 换源，vim /etc/apt/sources.list or 执行下面命令 分析环境 M1 mackoopro 是 arm 平台（aarch 是 arm v8 的一种状态） 我们的服务环境是 debian，x86_64，所以分析的环境最好也是同样的环境 强制拉 amd64 的 imag...","head":[["meta",{"property":"og:url","content":"https://blog.ruizhou.cf/tech/linux/gdb.html"}],["meta",{"property":"og:site_name","content":"rz blog"}],["meta",{"property":"og:title","content":"gdb"}],["meta",{"property":"og:description","content":"一次线上gdb分析 debian 换源 Ubuntu 22.04 换源，vim /etc/apt/sources.list or 执行下面命令 分析环境 M1 mackoopro 是 arm 平台（aarch 是 arm v8 的一种状态） 我们的服务环境是 debian，x86_64，所以分析的环境最好也是同样的环境 强制拉 amd64 的 imag..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-07-25T14:12:42.000Z"}],["meta",{"property":"article:author","content":"ruizhou"}],["meta",{"property":"article:tag","content":"linux"}],["meta",{"property":"article:tag","content":"shell"}],["meta",{"property":"article:published_time","content":"2023-04-25T07:27:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-07-25T14:12:42.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"gdb\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-04-25T07:27:00.000Z\\",\\"dateModified\\":\\"2023-07-25T14:12:42.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"ruizhou\\",\\"url\\":\\"https://blog.ruizhou.cf\\"}]}"]]},"headers":[{"level":2,"title":"一次线上gdb分析","slug":"一次线上gdb分析","link":"#一次线上gdb分析","children":[]},{"level":2,"title":"Reference","slug":"reference","link":"#reference","children":[]}],"git":{"createdTime":1681752780000,"updatedTime":1690294362000,"contributors":[{"name":"liuruizhou","email":"liuruizhou@bilibili.com","commits":1}]},"readingTime":{"minutes":4.18,"words":1255},"filePathRelative":"tech/linux/gdb.md","localizedDate":"2023年4月25日","excerpt":"","autoDesc":true}');export{c as comp,o as data};
