import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as t}from"./app-rFP3mJQ8.js";const e="/assets/image-20230722232025216-dyGkqysa.png",l={};function h(k,i){return t(),a("div",null,i[0]||(i[0]=[n(`<h3 id="客户端配置" tabindex="-1"><a class="header-anchor" href="#客户端配置"><span>客户端配置</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ClientParameters</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// After a duration of this time if the client doesn&#39;t see any activity it</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// pings the server to see if the transport is still alive.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// If set below 10s, a minimum value of 10s will be used instead.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	Time</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Duration</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // The current default value is infinity.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// After having pinged for keepalive check, the client waits for a duration</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// of Timeout and if no activity is seen even after that the connection is</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// closed.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	Timeout</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Duration</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // The current default value is 20 seconds.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// If true, client sends keepalive pings even with no active RPCs. If false,</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// when there are no active RPCs, Time and Timeout will be ignored and no</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// keepalive pings will be sent.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	PermitWithoutStream</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> bool</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // false by default.</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Time：<strong>没有活动后的保活时间</strong>，超过这个时间就会发ping给server；<code>默认无穷大，最小10s</code>，默认连接一直认为有效（B站设置60s）</p><p>Timeout：<strong>ping后等待时间</strong>，超过就断开连接；默认<code>20s</code>（B站设置20s）</p><p>PermitWithoutStream：true，<strong>连接在没活动时会定期发ping</strong>，结合上面👆两个参数；默认为<code>false</code>（B站没有设置，默认false）</p><h3 id="服务端配置" tabindex="-1"><a class="header-anchor" href="#服务端配置"><span>服务端配置</span></a></h3><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ServerParameters</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// MaxConnectionIdle is a duration for the amount of time after which an</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// idle connection would be closed by sending a GoAway. Idleness duration is</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// defined since the most recent time the number of outstanding RPCs became</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// zero or the connection establishment.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	MaxConnectionIdle</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Duration</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // The current default value is infinity.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// MaxConnectionAge is a duration for the maximum amount of time a</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// connection may exist before it will be closed by sending a GoAway. A</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// random jitter of +/-10% will be added to MaxConnectionAge to spread out</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// connection storms.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	MaxConnectionAge</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Duration</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // The current default value is infinity.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// MaxConnectionAgeGrace is an additive period after MaxConnectionAge after</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// which the connection will be forcibly closed.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	MaxConnectionAgeGrace</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Duration</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // The current default value is infinity.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// After a duration of this time if the server doesn&#39;t see any activity it</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// pings the client to see if the transport is still alive.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// If set below 1s, a minimum value of 1s will be used instead.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	Time</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Duration</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // The current default value is 2 hours.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// After having pinged for keepalive check, the server waits for a duration</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// of Timeout and if no activity is seen even after that the connection is</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// closed.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	Timeout</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Duration</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // The current default value is 20 seconds.</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>MaxConnectionIdle：<strong>idle空闲连接的存活时间</strong>，超过就发送GoAway帧（空闲连接的定义就是最近一次rpc调用之后的时间，或者连接刚刚建立作为起点计算没有rpc调用的维持时间）；默认<code>无限大</code>，默认连接无线存活（B站设置60s）</p><p>MaxConnectionAge：<strong>连接的最大存活时间</strong>，包括活跃连接和空闲连接，比上面👆应该要长点，超了要发送GoAway帧，并且防止同时关闭过多连接，加了随机扰动上下10%的时间；默认<code>无限大</code>，默认连接无线存活（B站设置2小时）</p><p>MaxConnectionAgeGrace：服务上面，到了时间但是会等待一段时间，来优雅关闭，主要为了有rpc的情况，让其顺利结束；默认无限大（B站设置20s）</p><p>Time：<strong>没有活动后的保活时间</strong>，超过这个时间就会发ping给client；默认2小时，最小1s，默认只认为和客户端保活<code>2小时</code>（B站设置60s）（B站设置60s）</p><p>Timeout：<strong>ping后等待时间</strong>，超过就断开连接；默认<code>20s</code>（B站设置20s）</p><h4 id="服务端自我保护策略" tabindex="-1"><a class="header-anchor" href="#服务端自我保护策略"><span>服务端自我保护策略</span></a></h4><p>B站没有设置</p><p>为了保护server端，限制客户端的ping的频率（<strong>等客户端4次ping来统计比较</strong>）</p><p>MinTime：<strong>客户端可以发送ping的最小间隔</strong>；默认是<code>5min</code>；需要<code>等客户端4次ping</code>，来比较MinTime，不符合就发送GoAway帧</p><p>PermitWithoutStream：true，允许没有rpc调用时client发送ping；默认<code>false</code>不允许，如果空间时间客户端发ping，那么server会发送GoAway帧来关闭连接；false状态下，需要<code>等客户端4次ping</code>，才会发送GoAway帧</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SETTINGS</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:41:43</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wrote</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SETTINGS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:41:43</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SETTINGS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=6,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> settings:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MAX_FRAME_SIZE=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">16384</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:41:43</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wrote</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SETTINGS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flags=ACK</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:41:43</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SETTINGS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flags=ACK</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PING-1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:42:16</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wrote</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ping=&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:42:16</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flags=ACK</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ping=&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PING-2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:42:49</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wrote</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ping=&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:42:49</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flags=ACK</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ping=&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PING-3</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:43:22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wrote</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ping=&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:43:22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flags=ACK</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ping=&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PING-4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:43:55</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wrote</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ping=&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:43:55</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PING</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> flags=ACK</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ping=&quot;\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">服务侧发来GOAWAY</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:43:55</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Framer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0x14000198000:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> GOAWAY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> len=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LastStreamID=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ErrCode=ENHANCE_YOUR_CALM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Debug=&quot;too_many_pings&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2023/07/22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:43:55</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ERROR:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [transport] Client received GoAway with error code ENHANCE_YOUR_CALM and debug data equal to ASCII </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;too_many_pings&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>43秒开始，16第一次ping，49第二次ping，22第三次ping，55第四次ping，同时发送GoAway帧</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// EnforcementPolicy is used to set keepalive enforcement policy on the</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// server-side. Server will close connection with a client that violates this</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// policy.</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> EnforcementPolicy</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// MinTime is the minimum amount of time a client should wait before sending</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// a keepalive ping.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	MinTime</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Duration</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // The current default value is 5 minutes.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// If true, server allows keepalive pings even when there are no active</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// streams(RPCs). If false, and client sends ping when there are no active</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// streams, server will send GOAWAY and close the connection.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	PermitWithoutStream</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> bool</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // false by default.</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>demo代码演示：https://github.com/xyz3282836/grpcdemo/tree/master/libtest</p><p>可以开启GODEBUG</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> GODEBUG</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">http2client</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # disable HTTP/2 client support</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> GODEBUG</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">http2server</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # disable HTTP/2 server support</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> GODEBUG</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">http2debug</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # enable verbose HTTP/2 debug logs</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> GODEBUG</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">http2debug</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # ... even more verbose, with frame dumps</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>一次普通请求，收发包的帧日志</p><p>服务端配置，第一个EnforcementPolicy.PermitWithoutStream为false，其实就是默认配置，此配置等价于没有配置，直接看第二个配置就好</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> kaep</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> keepalive</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">EnforcementPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	MinTime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:             </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// If a client pings more than once every 5 seconds, terminate the connection</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	PermitWithoutStream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Allow pings even when there are no active streams</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> kasp</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> keepalive</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ServerParameters</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	MaxConnectionIdle</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:     </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// If a client is idle for 15 seconds, send a GOAWAY</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	MaxConnectionAge</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:      </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6000</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// If any connection is alive for more than 30 seconds, send a GOAWAY</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	MaxConnectionAgeGrace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Allow 5 seconds for pending RPCs to complete before forcibly closing connections</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	Time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:                  </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">15</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Ping the client if it is idle for 5 seconds to ensure the connection is still active</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	Timeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:               </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Wait 1 second for the ping ack before assuming the connection is dead</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>客户端配置，Time超过服务侧，所以客户端发起ping</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> kacp</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> keepalive</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ClientParameters</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	Time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:                </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// send pings every 10 seconds if there is no activity</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	Timeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:             </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Second</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,      </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// wait 1 second for ping ack before considering the connection dead</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	PermitWithoutStream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// send pings even without active streams</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>左边client，右边server</p><figure><img src="`+e+'" alt="client-service-fram-logging" tabindex="0" loading="lazy"><figcaption>client-service-fram-logging</figcaption></figure><h2 id="reference" tabindex="-1"><a class="header-anchor" href="#reference"><span>reference</span></a></h2><p>https://zhuanlan.zhihu.com/p/530266840</p><p>https://go.dev/src/net/http/doc.go</p><p>https://pandaychen.github.io/2020/09/01/GRPC-CLIENT-CONN-LASTING/</p>',34)]))}const d=s(l,[["render",h],["__file","keepalive.html.vue"]]),g=JSON.parse('{"path":"/tech/source/grpc/keepalive.html","title":"keepalive","lang":"zh-CN","frontmatter":{"title":"keepalive","date":"2023-07-22T14:40:00.000Z","category":"技术","tag":["grpc","keepalive"],"description":"客户端配置 Time：没有活动后的保活时间，超过这个时间就会发ping给server；默认无穷大，最小10s，默认连接一直认为有效（B站设置60s） Timeout：ping后等待时间，超过就断开连接；默认20s（B站设置20s） PermitWithoutStream：true，连接在没活动时会定期发ping，结合上面👆两个参数；默认为false（...","head":[["meta",{"property":"og:url","content":"https://blog.ruizhou.cf/tech/source/grpc/keepalive.html"}],["meta",{"property":"og:site_name","content":"rz blog"}],["meta",{"property":"og:title","content":"keepalive"}],["meta",{"property":"og:description","content":"客户端配置 Time：没有活动后的保活时间，超过这个时间就会发ping给server；默认无穷大，最小10s，默认连接一直认为有效（B站设置60s） Timeout：ping后等待时间，超过就断开连接；默认20s（B站设置20s） PermitWithoutStream：true，连接在没活动时会定期发ping，结合上面👆两个参数；默认为false（..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-01-26T16:16:19.000Z"}],["meta",{"property":"article:tag","content":"grpc"}],["meta",{"property":"article:tag","content":"keepalive"}],["meta",{"property":"article:published_time","content":"2023-07-22T14:40:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-01-26T16:16:19.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"keepalive\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-07-22T14:40:00.000Z\\",\\"dateModified\\":\\"2024-01-26T16:16:19.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"ruizhou\\",\\"url\\":\\"https://blog.ruizhou.cf\\"}]}"]]},"headers":[{"level":3,"title":"客户端配置","slug":"客户端配置","link":"#客户端配置","children":[]},{"level":3,"title":"服务端配置","slug":"服务端配置","link":"#服务端配置","children":[{"level":4,"title":"服务端自我保护策略","slug":"服务端自我保护策略","link":"#服务端自我保护策略","children":[]}]},{"level":2,"title":"reference","slug":"reference","link":"#reference","children":[]}],"git":{"createdTime":1706285779000,"updatedTime":1706285779000,"contributors":[{"name":"liuruizhou","email":"liuruizhou@bilibili.com","commits":1}]},"readingTime":{"minutes":5.45,"words":1634},"filePathRelative":"tech/source/grpc/keepalive.md","localizedDate":"2023年7月22日","excerpt":"","autoDesc":true}');export{d as comp,g as data};
