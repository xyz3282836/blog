import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,a as n,o as i}from"./app-DfD5DVCG.js";const l={};function t(h,s){return i(),e("div",null,[...s[0]||(s[0]=[n(`<h2 id="mac-keychain" tabindex="-1"><a class="header-anchor" href="#mac-keychain"><span>mac keychain</span></a></h2><p>将ssh的密钥添加到keychain</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssh-add</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --apple-use-keychain</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ~/.ssh/rsa_</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span></code></pre></div><p>配置<code>.ssh</code>目录下<code>config</code>文件</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Host github.com</span></span>
<span class="line"><span>AddKeysToAgent yes</span></span>
<span class="line"><span>UseKeychain yes</span></span>
<span class="line"><span>IdentityFile ~/.ssh/rsa_github</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Host git.bilibili.co</span></span>
<span class="line"><span>AddKeysToAgent yes</span></span>
<span class="line"><span>UseKeychain yes</span></span>
<span class="line"><span>IdentityFile ~/.ssh/rsa_gitlab</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Host 104.160.45.229</span></span>
<span class="line"><span>AddKeysToAgent yes</span></span>
<span class="line"><span>UseKeychain yes</span></span>
<span class="line"><span>IdentityFile ~/.ssh/rsa_bwg</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="addkeystoagent" tabindex="-1"><a class="header-anchor" href="#addkeystoagent"><span>AddKeysToAgent</span></a></h2><p>在 SSH 配置文件（~/.ssh/config）中，AddKeysToAgent 是一个配置选项，它的作用是控制是否将私钥自动添加到 ssh-agent 中。以下是它的具体作用和相关说明：</p><h3 id="作用" tabindex="-1"><a class="header-anchor" href="#作用"><span>作用</span></a></h3><ul><li><strong>自动加载密钥</strong>：当设置为 yes 时，ssh 命令会自动将私钥添加到 ssh-agent 中。这样，用户在使用 SSH 连接时，就不需要手动运行 ssh-add 命令来添加密钥。</li><li><strong>简化操作</strong>：避免每次使用 SSH 时都需要手动输入密钥密码，提高了使用 SSH 的便捷性。</li><li><strong>安全性</strong>：通过 ssh-agent 管理密钥，可以将密钥的解密操作限制在内存中，而不是直接暴露密钥文件，从而提高安全性。</li></ul><h3 id="可能的值" tabindex="-1"><a class="header-anchor" href="#可能的值"><span>可能的值</span></a></h3><ul><li><strong>yes</strong>：自动将私钥添加到 ssh-agent 中。</li><li><strong>no</strong>：不自动添加私钥到 ssh-agent 中。</li><li><strong>confirm</strong>：在每次使用密钥时，要求用户确认是否允许使用该密钥。</li><li><strong>ask</strong>：在第一次使用密钥时，提示用户是否要将其添加到 ssh-agent 中。</li></ul><h3 id="使用场景" tabindex="-1"><a class="header-anchor" href="#使用场景"><span>使用场景</span></a></h3><p>假设你有一个私钥文件 ~/.ssh/id_rsa，并且你希望在每次使用 SSH 时自动加载该密钥，而不需要手动运行 ssh-add 命令，你可以在 ~/.ssh/config 文件中添加以下配置：</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Host *</span></span>
<span class="line"><span>    AddKeysToAgent yes</span></span>
<span class="line"><span>    IdentityFile ~/.ssh/id_rsa</span></span></code></pre></div><p>这样，当你使用 ssh 命令连接到远程服务器时，ssh 会自动将 ~/.ssh/id_rsa 添加到 ssh-agent 中，并且在后续的连接中不再需要手动输入密钥密码。</p><h3 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h3><ul><li><strong>安全性</strong>：虽然 AddKeysToAgent 提高了使用 SSH 的便捷性，但也需要注意安全性。确保只有可信的用户可以访问你的 SSH 配置文件和密钥文件。</li><li><strong>兼容性</strong>：AddKeysToAgent 是 OpenSSH 7.2 及更高版本引入的特性。如果你使用的是较旧版本的 OpenSSH，可能需要手动运行 ssh-add 命令来添加密钥。</li></ul><p>总之，AddKeysToAgent 是一个非常实用的配置选项，可以显著简化 SSH 的使用流程，同时也能在一定程度上提高安全性。</p><h2 id="usekeychain" tabindex="-1"><a class="header-anchor" href="#usekeychain"><span>UseKeychain</span></a></h2><p>UseKeychain 是 macOS 系统中 SSH 配置文件（~/.ssh/config）的一个选项，它的作用是指示 SSH 在 macOS 的钥匙串（Keychain）中查找和存储私钥的密码。以下是它的具体作用和使用场景：</p><h3 id="作用-1" tabindex="-1"><a class="header-anchor" href="#作用-1"><span>作用</span></a></h3><ol><li><strong>存储私钥密码</strong>： <ul><li>当你使用 ssh-add --apple-use-keychain 或 ssh-add -K 将私钥添加到 ssh-agent 时，UseKeychain 选项会确保私钥的密码被存储在 macOS 的钥匙串中。</li><li>这样，你不需要每次重启电脑或打开终端时手动输入私钥的密码。</li></ul></li><li><strong>自动加载私钥</strong>： <ul><li>当你在 ~/.ssh/config 文件中设置 UseKeychain yes 时，SSH 会自动从钥匙串中读取私钥的密码，并将其加载到 ssh-agent 中。</li><li>这使得 SSH 连接更加便捷，尤其是在需要频繁使用 SSH 的场景中。</li></ul></li><li><strong>提高安全性</strong>： <ul><li>钥匙串是一个安全的存储系统，可以保护私钥的密码不被未授权访问。</li><li>通过将私钥密码存储在钥匙串中，可以避免将密码明文存储在文件中，从而提高安全性。</li></ul></li></ol><h3 id="使用场景-1" tabindex="-1"><a class="header-anchor" href="#使用场景-1"><span>使用场景</span></a></h3><p>假设你有一个私钥文件 ~/.ssh/id_rsa，并且你希望在每次使用 SSH 时自动加载该私钥，同时将密码存储在钥匙串中，你可以在 ~/.ssh/config 文件中添加以下配置：</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Host *</span></span>
<span class="line"><span>    AddKeysToAgent yes</span></span>
<span class="line"><span>    UseKeychain yes</span></span>
<span class="line"><span>    IdentityFile ~/.ssh/id_rsa</span></span></code></pre></div><p>这样，当你使用 ssh 命令连接到远程服务器时，SSH 会自动从钥匙串中读取私钥的密码，并将其加载到 ssh-agent 中，而不需要手动输入密码。</p><h3 id="注意事项-1" tabindex="-1"><a class="header-anchor" href="#注意事项-1"><span>注意事项</span></a></h3><ol><li><strong>仅适用于 macOS</strong>： <ul><li>UseKeychain 是 macOS 系统特有的功能，不适用于 Linux 或 Windows 系统。</li><li>如果你在 macOS 上使用了非苹果自带的 OpenSSH 版本（例如通过 Homebrew 安装的 OpenSSH），可能需要确保该版本支持 --apple-use-keychain 和 --apple-load-keychain 选项[<sup>9</sup>]。</li></ul></li><li><strong>配置文件格式</strong>： <ul><li>如果你在配置文件中遇到 Bad configuration option: usekeychain 错误，可能是因为你的 SSH 版本不支持该选项，或者配置文件格式有误。确保你的 SSH 版本是 macOS 自带的版本，并且配置文件格式正确[<sup>10</sup>]。</li></ul></li><li><strong>安全性</strong>： <ul><li>虽然将私钥密码存储在钥匙串中可以提高便利性，但也需要注意安全性。确保只有可信的用户可以访问你的钥匙串和 SSH 配置文件。</li></ul></li></ol><p>总之，UseKeychain 是一个非常实用的配置选项，可以显著提高使用 SSH 的便捷性和安全性，特别是在 macOS 系统中。</p><h2 id="疑问" tabindex="-1"><a class="header-anchor" href="#疑问"><span>疑问</span></a></h2><p>即使已经将私钥存入 Keychain，IdentityFile 在 SSH 配置中仍然是有用的，甚至在某些情况下是必要的。以下是它们各自的作用和为什么两者都需要的原因：</p><h3 id="identityfile-的作用" tabindex="-1"><a class="header-anchor" href="#identityfile-的作用"><span>IdentityFile 的作用</span></a></h3><p>IdentityFile 是 SSH 配置文件中的一个指令，用于指定私钥文件的路径。它的主要作用是告诉 SSH 客户端在进行身份验证时应该使用哪个私钥文件。</p><h3 id="usekeychain-的作用" tabindex="-1"><a class="header-anchor" href="#usekeychain-的作用"><span>UseKeychain 的作用</span></a></h3><p>UseKeychain 是 macOS 特有的配置选项，用于指示 SSH 客户端从 Keychain 中读取私钥的密码。它确保私钥的密码被安全地存储在 Keychain 中，并且在需要时自动加载。</p><h3 id="为什么两者都需要" tabindex="-1"><a class="header-anchor" href="#为什么两者都需要"><span>为什么两者都需要</span></a></h3><ol><li><strong>指定私钥文件</strong>： <ul><li>IdentityFile 明确指定了私钥文件的路径。即使私钥的密码已经存储在 Keychain 中，SSH 客户端仍然需要知道私钥文件的位置。</li><li>如果不指定 IdentityFile，SSH 客户端会默认查找 ~/.ssh/id_rsa、~/.ssh/id_dsa、~/.ssh/id_ecdsa、~/.ssh/id_ed25519 等默认私钥文件。如果私钥文件不在默认位置，SSH 客户端将无法找到正确的私钥文件。</li></ul></li><li><strong>自动加载密钥</strong>： <ul><li>UseKeychain 确保私钥的密码被存储在 Keychain 中，并在需要时自动加载。</li><li>IdentityFile 指定了私钥文件的位置，SSH 客户端在加载私钥时会结合 UseKeychain 从 Keychain 中读取密码。</li></ul></li></ol><h3 id="示例配置" tabindex="-1"><a class="header-anchor" href="#示例配置"><span>示例配置</span></a></h3><p>假设你有一个私钥文件 ~/.ssh/id_rsa，并且已经将该私钥的密码存储在 Keychain 中，你的 ~/.ssh/config 文件可以这样配置：</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Host *</span></span>
<span class="line"><span>    AddKeysToAgent yes</span></span>
<span class="line"><span>    UseKeychain yes</span></span>
<span class="line"><span>    IdentityFile ~/.ssh/id_rsa</span></span></code></pre></div><ul><li><strong>IdentityFile ~/.ssh/id_rsa</strong>：明确指定了私钥文件的位置。</li><li><strong>UseKeychain yes</strong>：指示 SSH 客户端从 Keychain 中读取私钥的密码。</li><li><strong>AddKeysToAgent yes</strong>：确保私钥被自动添加到 ssh-agent 中。</li></ul><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><ul><li><strong>IdentityFile</strong>：告诉 SSH 客户端私钥文件的位置。</li><li><strong>UseKeychain</strong>：确保私钥的密码被安全地存储在 Keychain 中，并在需要时自动加载。</li></ul><p>两者结合使用，可以确保 SSH 客户端能够正确找到并使用私钥文件，同时利用 Keychain 提供的安全性和便捷性。</p>`,44)])])}const d=a(l,[["render",t]]),r=JSON.parse('{"path":"/tech/mac/ssh_config.html","title":"mac ssh key 记忆配置","lang":"zh-CN","frontmatter":{"title":"mac ssh key 记忆配置","date":"2025-10-16T09:10:00.000Z","category":"SSH","tag":["ssh-add","mac","keychain"],"description":"mac keychain 将ssh的密钥添加到keychain 配置.ssh目录下config文件 AddKeysToAgent 在 SSH 配置文件（~/.ssh/config）中，AddKeysToAgent 是一个配置选项，它的作用是控制是否将私钥自动添加到 ssh-agent 中。以下是它的具体作用和相关说明： 作用 自动加载密钥：当设置为 y...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"mac ssh key 记忆配置\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-10-16T09:10:00.000Z\\",\\"dateModified\\":\\"2025-10-16T09:34:20.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"ruizhou\\",\\"url\\":\\"https://blog.ruizhou.cf\\"}]}"],["meta",{"property":"og:url","content":"https://blog.ruizhou.cf/tech/mac/ssh_config.html"}],["meta",{"property":"og:site_name","content":"rz blog"}],["meta",{"property":"og:title","content":"mac ssh key 记忆配置"}],["meta",{"property":"og:description","content":"mac keychain 将ssh的密钥添加到keychain 配置.ssh目录下config文件 AddKeysToAgent 在 SSH 配置文件（~/.ssh/config）中，AddKeysToAgent 是一个配置选项，它的作用是控制是否将私钥自动添加到 ssh-agent 中。以下是它的具体作用和相关说明： 作用 自动加载密钥：当设置为 y..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-10-16T09:34:20.000Z"}],["meta",{"property":"article:tag","content":"keychain"}],["meta",{"property":"article:tag","content":"mac"}],["meta",{"property":"article:tag","content":"ssh-add"}],["meta",{"property":"article:published_time","content":"2025-10-16T09:10:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-10-16T09:34:20.000Z"}]]},"git":{"createdTime":1760607260000,"updatedTime":1760607260000,"contributors":[{"name":"liuruizhou","username":"liuruizhou","email":"liuruizhou@bilibili.com","commits":1,"url":"https://github.com/liuruizhou"}]},"readingTime":{"minutes":5.91,"words":1774},"filePathRelative":"tech/mac/ssh_config.md","excerpt":"","autoDesc":true}');export{d as comp,r as data};
